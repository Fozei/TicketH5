<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8"/>
    <meta name="author" content="订票系统"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="apple-mobile-web-apple-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title></title>
    <link rel="stylesheet" type="text/css" href="css/basic.css"/>
    <script src="js/jquery-1.12.0.min.js"></script>
    <script src="js/layer/mobile/layer.js"></script>
    <script src="js/auto.js"></script>
    <script src="js/common.js"></script>
    <script src="js/layer/layer.js"></script>
	<script src="js/constance.js"></script>

</head>

<body>
	<div id="orderContent"></div>
	<input type="hidden" id="num" />
	<a href="javascript:void(0);" onClick="submit();">提交</a>
</body>
<script src="js/jquery-1.12.0.min.js">
</script>
<script src="js/utils.js">
</script>
<script type="text/javascript">
<!--
var orderID = getQueryString('orderID');
var index = layer.load(0, {
    shade: [0.3, 'black'] //0.1透明度的白色背景
});
$(function(){

	$.ajax({
        url: DOMAIN + TICKET_SEAT_COUNT,
        data: {
            'orderID': orderID
        },
        type: "POST",
        async: false,
        dataType: "json",
        success: function (data) {
            var n = data.num;
            var str = '';
            for (var i = 0; i < n; i++) {
              str+='<p>身份证：<input type="text" id="idNumber'+i+'" value="" /></p><p>姓名：<input type="text" id="name'+i+'" value="" /></p>';
            }
            $('#orderContent').html(str);
			$('#num').val(n);
            layer.close(index);

        }
    });
})

function submit(){
	var n = $('#num').val();
	var data=new Array();
	for (var i = 0; i < n; i++) {
        var name = $('#name'+i).val();
		var idCard = $('#idNumber'+i).val();
		data[i]= new Array(idCard,name);
		i++;
     }
	 if (data.length==0)
	{
		layer.msg('请填写身份证');
        return false;
	}
	for (var i=0;i<data.length;i++)
	{
			
		if (data[i][0]=='')
		{
			layer.msg('请填写身份证');
			return false;
		}else if (!ChinaIdChecker_r(data[i][0]))
		{
			//layer.msg('请填写正确身份证');
			//return false;
		}
		if (data[i][1]=='')
		{
			layer.msg('请填写姓名');
			return false;
		}
	}
	$.ajax({
        url: DOMAIN + TICKET_ADDCARD,
        data: {
            'orderID': orderID,
			'seatData':data
        },
        type: "POST",
        async: false,
        dataType: "json",
        success: function (data) {
           if (data.code=='success')
           {
			   var ticketID = data.orderData.ticket_id;
			   var timeID = data.orderData.time_id;
			   var order_num = data.orderData.order_num;
			   location.href=DOMAIM_API+'web/ticketconfirm.php?ticketID='+ticketID+'&orderNum='+order_num+'&timeID='+timeID;
           }else{
				layer.msg(data.message);
				return false;
		   }
			
        }
    });
}
//-->
</script>
</html>
